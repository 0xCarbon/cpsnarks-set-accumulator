/// See https://bheisler.github.io/criterion.rs/book/getting_started.html to add more benchmarks.
#[macro_use]
extern crate criterion;

use criterion::Criterion;
use crypto::group::{DummyRSA2048, ElemFromUnsigned, Group, RSA2048};
use crypto::util::bu;
use num::BigUint;
use std::str::FromStr;

fn bench_op_simple<G: ElemFromUnsigned>() {
  G::op(&G::elem_of(3u8), &G::elem_of(4u8));
}

#[allow(dead_code)]
fn bench_op<G: ElemFromUnsigned>() {
  G::op(
    &G::elem_of(BigUint::from_str("217207389955395428589369158781869218697519159898401521658993038615824872408108784926597517\
        496727372037176277380476487000099770530440575029170919732871116716934260655466121508332329\
        543615367099810550371217642707848747209719337160655740326150736137284544974770721296865388\
        733305727739636960186370782308858960903126545368015203728531224712542949463283059298449823\
        194163842041340565518401459166858709515078878951293564147044227487142171138804897039341476\
        125519380825017530552968018297030172607314398711102156189885095451290884843968486448057303\
        47466581515692959313583208325725034506693916571047785061884094866050395109710").unwrap()),
    &G::elem_of(BigUint::from_str("317207389955395428589369158781869218697519159898401521658993038615824872408108784926597517\
        496727372037176277380476487000099770530440575029170919732871116716934260655466121508332329\
        543615367099810550371217642707848747209719337160655740326150736137284544974770721296865388\
        733305727739636960186370782308858960903126545368015203728531224712542949463283059298449823\
        194163842041340565518401459166858709515078878951293564147044227487142171138804897039341476\
        125519380825017530552968018297030172607314398711102156189885095451290884843968486448057303\
        47466581515692959313583208325725034506693916571047785061884094866050395109710").unwrap()),
  );
}

fn bench_exp<G: ElemFromUnsigned>() {
  G::exp(&G::elem_of(2u8), &bu(4097u32));
}

fn bench_inv<G: ElemFromUnsigned>() {
  G::inv(&G::elem_of(2u8));
}

fn criterion_benchmark(c: &mut Criterion) {
  c.bench_function("op_simple_dummy", |b| {
    b.iter(bench_op_simple::<DummyRSA2048>)
  });
  c.bench_function("op_simple_real", |b| b.iter(bench_op_simple::<RSA2048>));
  c.bench_function("exp_dummy", |b| b.iter(bench_exp::<DummyRSA2048>));
  c.bench_function("exp_real", |b| b.iter(bench_exp::<RSA2048>));
  c.bench_function("inv_dummy", |b| b.iter(bench_inv::<DummyRSA2048>));
  c.bench_function("inv_real", |b| b.iter(bench_inv::<RSA2048>));
}

criterion_group!(benches, criterion_benchmark);
criterion_main!(benches);
