/// See https://bheisler.github.io/criterion.rs/book/getting_started.html to add more benchmarks.
#[macro_use]
extern crate criterion;

use criterion::Criterion;
use crypto::group::{DummyRSA2048, Group, RSA2048};
use crypto::util::bu;
use num::BigUint;
use std::str::FromStr;

fn bench_op_simple_dummy() {
  DummyRSA2048::op(
    &DummyRSA2048::elem_of(bu(3u8)),
    &DummyRSA2048::elem_of(bu(4u8)),
  );
}

#[allow(dead_code)]
fn bench_op_dummy() {
  DummyRSA2048::op(
    &DummyRSA2048::elem_of(BigUint::from_str("217207389955395428589369158781869218697519159898401521658993038615824872408108784926597517\
        496727372037176277380476487000099770530440575029170919732871116716934260655466121508332329\
        543615367099810550371217642707848747209719337160655740326150736137284544974770721296865388\
        733305727739636960186370782308858960903126545368015203728531224712542949463283059298449823\
        194163842041340565518401459166858709515078878951293564147044227487142171138804897039341476\
        125519380825017530552968018297030172607314398711102156189885095451290884843968486448057303\
        47466581515692959313583208325725034506693916571047785061884094866050395109710").unwrap()),
    &DummyRSA2048::elem_of(BigUint::from_str("317207389955395428589369158781869218697519159898401521658993038615824872408108784926597517\
        496727372037176277380476487000099770530440575029170919732871116716934260655466121508332329\
        543615367099810550371217642707848747209719337160655740326150736137284544974770721296865388\
        733305727739636960186370782308858960903126545368015203728531224712542949463283059298449823\
        194163842041340565518401459166858709515078878951293564147044227487142171138804897039341476\
        125519380825017530552968018297030172607314398711102156189885095451290884843968486448057303\
        47466581515692959313583208325725034506693916571047785061884094866050395109710").unwrap()),
  );
}

fn bench_exp_dummy() {
  DummyRSA2048::exp(&DummyRSA2048::elem_of(bu(2u8)), &bu(4097u32));
}

fn bench_inv_dummy() {
  DummyRSA2048::inv(&DummyRSA2048::elem_of(bu(2u8)));
}

fn bench_op_simple_real() {
  RSA2048::op(&RSA2048::elem_of(bu(3u8)), &RSA2048::elem_of(bu(4u8)));
}

/// Panics right now!
#[allow(dead_code)]
fn bench_op_real() {
  RSA2048::op(
    &RSA2048::elem_of(BigUint::from_str("217207389955395428589369158781869218697519159898401521658993038615824872408108784926597517\
        496727372037176277380476487000099770530440575029170919732871116716934260655466121508332329\
        543615367099810550371217642707848747209719337160655740326150736137284544974770721296865388\
        733305727739636960186370782308858960903126545368015203728531224712542949463283059298449823\
        194163842041340565518401459166858709515078878951293564147044227487142171138804897039341476\
        125519380825017530552968018297030172607314398711102156189885095451290884843968486448057303\
        47466581515692959313583208325725034506693916571047785061884094866050395109710").unwrap()),
    &RSA2048::elem_of(BigUint::from_str("317207389955395428589369158781869218697519159898401521658993038615824872408108784926597517\
        496727372037176277380476487000099770530440575029170919732871116716934260655466121508332329\
        543615367099810550371217642707848747209719337160655740326150736137284544974770721296865388\
        733305727739636960186370782308858960903126545368015203728531224712542949463283059298449823\
        194163842041340565518401459166858709515078878951293564147044227487142171138804897039341476\
        125519380825017530552968018297030172607314398711102156189885095451290884843968486448057303\
        47466581515692959313583208325725034506693916571047785061884094866050395109710").unwrap()),
  );
}

fn bench_exp_real() {
  RSA2048::exp(&RSA2048::elem_of(bu(2u8)), &bu(4096u32));
}

fn bench_inv_real() {
  RSA2048::inv(&RSA2048::elem_of(bu(2u8)));
}

fn criterion_benchmark(c: &mut Criterion) {
  c.bench_function("op_simple_dummy", |b| b.iter(bench_op_simple_dummy));
  c.bench_function("op_simple_real", |b| b.iter(bench_op_simple_real));
  c.bench_function("exp_dummy", |b| b.iter(bench_exp_dummy));
  c.bench_function("exp_real", |b| b.iter(bench_exp_real));
  c.bench_function("inv_dummy", |b| b.iter(bench_inv_dummy));
  c.bench_function("inv_real", |b| b.iter(bench_inv_real));
}

criterion_group!(benches, criterion_benchmark);
criterion_main!(benches);
